apiVersion: configs.flanksource.com/v1
kind: ScrapePlugin
metadata:
  name: aws-locations
  namespace: mc
spec:
  locations:
    - type: AWS::*
      # filter: ['region', 'zone', 'vpc', 'subnet'].all(tag, has(tags[tag]))
      filter: has(tags.region) && has(tags.zone) && has(tags.vpc) && has(tags.subnet)
      values:
        - network://{{tags.region}}/{{.tags.vpc}}/{{.tags.zone}}/{{tags.subnet}}
  aliases:
    - type: AWS::EC2::VPC
      values:
        - network://{{tags.region}}/{{.id}}
    - type: AWS::EC2::Subnet
      filter: has(tags.region) && has(tags.zone) && has(labels.network)
      values:
        - network://{{tags.region}}/{{labels.network}}/{{.tags.zone}}
