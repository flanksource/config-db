---
apiVersion: configs.flanksource.com/v1
kind: ScrapeConfig
metadata:
  name: slack-flanksource
  namespace: default
spec:
  schedule: '@every 5h'
  slack:
    - channels:
        - 'notification-*'
      since: 7d
      token:
        valueFrom:
          secretKeyRef:
            name: slack-mission-control-bot
            key: token
      rules:
        - regexp: name:\s*(?<name>.*?)\s+type:\s*(?<type>.*?)\s+is\s+.*\nseverity:\s*(?<severity>\w+)
          filter:
            bot: 'Notifier'
            expr: text.contains('healthy') # match healthy/unhealthy
          config:
            - name:
                expr: name
              type:
                expr: type
          mapping:
            type:
              expr: severity
